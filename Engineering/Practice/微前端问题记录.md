## 子应用切换时样式重新加载

打包时开启压缩配置，组件中的 CSS 提取关闭

```
module.exports = {
  css: {
    // extract: process.env.NODE_ENV === 'production',
    extract: false,
    loaderOptions: {
      less: {
        lessOptions: {
          javascriptEnabled: true
        }
      }
    }
  },
  configureWebpack: {
    resolve: {
      alias: {
        Assets: path.join(__dirname, '/src/assets'),
        Coms: path.join(__dirname, '/src/components'),
        Views: path.join(__dirname, '/src/views'),
        Config: path.join(__dirname, '/src/config'),
        Util: path.join(__dirname, '/src/util')
      }
    },
    optimization: {
      minimizer: [
        new TerserPlugin({
          terserOptions: {
            compress: {
              pure_funcs: ['console.log'] //忽略console.log语句
            }
          }
        })
      ],
      splitChunks: {
        cacheGroups: {
          vendor: {
            // 第三方库抽离
            chunks: 'all',
            test: /node_modules/,
            name: 'chunk-vendor',
            minChunks: 1,
            maxInitialRequests: 5,
            minSize: 300000,
            priority: 100,
          },
          common: {
            // 公用模块抽离
            chunks: 'all',
            test: /[\\/]src[\\/]js[\\/]/,
            name: 'common',
            minChunks: 2,
            maxInitialRequests: 5,
            minSize: 300000,
            priority: 60,
          },
          styles: {
            // 样式抽离
            name: 'styles',
            test: /\.(sa|sc|c|le)ss$/,
            chunks: 'all',
            enforce: true,
          },
          ml: {
            name: 'ml',
            test: /[\\/]node_modules[\\/][\\@]ailpha[\\/]ml[\\/]/,
            chunks: 'all',
            priority: 200,
            reuseExistingChunk: true,
            enforce: true,
          },
          umy: {
            name: 'umy-ui',
            test: /[\\/]node_modules[\\/]umy-ui[\\/]/,
            chunks: 'all',
            priority: 200,
            reuseExistingChunk: true,
            enforce: true,
          },
          lodash: {
            name: 'lodash',
            test: /[\\/]node_modules[\\/]lodash[\\/]/,
            chunks: 'all',
            priority: 200,
            reuseExistingChunk: true,
            enforce: true,
          },
          echarts: {
            name: 'echarts',
            test: /[\\/]node_modules[\\/]echarts[\\/]/,
            chunks: 'all',
            priority: 200,
            reuseExistingChunk: true,
            enforce: true,
          },
        },
      },
    },
    plugins: [
      new CompressionPlugin({
        filename: '[path][base].gz',
        algorithm: 'gzip',
        test: productionGzipExtensions,
        threshold: 10240,
        minRatio: 0.8,
      }),
    ],
    output: {
      // 微应用的包名，这里与主应用中注册的微应用名称一致
      library: 'SortMicroApp',
      // 将你的 library 暴露为所有的模块定义下都可运行的方式
      libraryTarget: 'umd',
      // 按需加载相关，设置为 webpackJsonp_MaskMicroApp 即可
      jsonpFunction: 'webpackJsonp_SortMicroApp'
    }
  },
};
```

nginx/nginx.conf
```
user  root;
worker_processes  1;

error_log  /var/log/nginx/error.log warn;
pid        /var/run/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    keepalive_timeout  65;
    #gzip  on;
    gzip_static on; // nginx 静态压缩

    include /etc/nginx/conf.d/*.conf;
}
```

nginx/conf.d/default.conf
```
# 主应用
server {
    listen    80;
    ssl       on;
    ssl_certificate  conf.d/cert.crt;
    ssl_certificate_key  conf.d/rsa_private.key;
    ssl_protocols TLSv1 TLSv1.1 TLSv1.2;

    server_name    localhost;
    location /{
        root    /root/front;
        index  index.html index.htm;
        try_files $uri $uri/ /index.html;

        expires -1;                          # 首页一般没有强制缓存
        add_header Cache-Control no-cache;
    }

    location /asset {
        proxy_pass http://asset:9012; # 接口地址(变量名为docker服务名)
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header x_real_ipP $remote_addr;
        proxy_set_header remote_addr $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_http_version 1.1;
        proxy_connect_timeout 3000s;
        proxy_read_timeout 3000s;
        proxy_send_timeout 3000s;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection upgrade;
    }
    
    location /asset/ws/push {
            proxy_pass http://asset:9012/asset/ws/push;
            proxy_http_version 1.1;
            proxy_read_timeout 360s;   
            proxy_redirect off;   
            proxy_set_header Upgrade $http_upgrade; 
            proxy_set_header Connection "upgrade";    #配置连接为升级连接
            proxy_set_header Host $host:;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header REMOTE-HOST $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }

    location /asset/license/ {
        proxy_pass http://license:9022/license/; # 接口地址
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header x_real_ipP $remote_addr;
        proxy_set_header remote_addr $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_http_version 1.1;
        proxy_connect_timeout 3000s;
        proxy_read_timeout 3000s;
        proxy_send_timeout 3000s;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection upgrade;
    }

    location /mask-api {
        proxy_pass http://webapp:7089/AiMask/webApp/; # 接口地址
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header x_real_ipP $remote_addr;
        proxy_set_header remote_addr $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_http_version 1.1;
        proxy_connect_timeout 3000s;
        proxy_read_timeout 3000s;
        proxy_send_timeout 3000s;
        proxy_max_temp_file_size 10240m;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection upgrade;
        client_max_body_size 200m; # 上传文件大小限制
        client_body_timeout 5m;
    }

location /asset/user-service/ {
    proxy_pass http://user:9096/user-service/; # 接口地址
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header x_real_ipP $remote_addr;
    proxy_set_header remote_addr $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_http_version 1.1;
    proxy_connect_timeout 3000s;
    proxy_read_timeout 3000s;
    proxy_send_timeout 3000s;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection upgrade;
  }

  location /mask-api/user-service/ {
    proxy_pass http://user:9096/user-service/; # 接口地址
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
    proxy_set_header x_real_ipP $remote_addr;
    proxy_set_header remote_addr $remote_addr;
    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    proxy_http_version 1.1;
    proxy_connect_timeout 3000s;
    proxy_read_timeout 3000s;
    proxy_send_timeout 3000s;
    proxy_set_header Upgrade $http_upgrade;
    proxy_set_header Connection upgrade;
  }

    # 前端aisort
    location /child/dataGovernance/ {
      root   /root/front;
      index  index.html index.htm;
      try_files $uri $uri/ /child/dataGovernance/index.html;
    }
    # 前端aimask
    location /child/aiMask/ {
      root   /root/front;
      index  index.html index.htm;
      try_files $uri $uri/ /child/aiMask/index.html;
    }
    

    # 模板标准附件
    location /static/template/ {
        alias    /root/static/template/;
    }
    error_page    500 502 503 504  /50x.html;
    location = /50x.html {
        root    html;
    }
}
```

前端包目录结构：
```
front
 -- child
   -- aiMask
   -- dataGovernance
```
