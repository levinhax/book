### 问题描述

连续调用表格列表数据的接口，偶尔会出现一次接口请求的延迟(3s)

### 可能原因

1. 接口服务的系统延时
2. 调用时nginx转发影响

使用postman接口测试时，发现并没有此现象，考虑可能是nginx接口转发的影响。查看nginx日志，看request_time 和response_time，发现确实，返回时间比较长。因为在外网机器上并没有此现象，可能是机器性能造成的，所以准备给nginx开启多线程。

一般一个进程足够了，你可以把连接数设得很大。
如果有SSL、gzip这些比较消耗CPU的工作，而且是多核CPU的话，可以设为和CPU的数量一样。
或者要处理很多很多的小文件，而且文件总大小比内存大很多的时候，也可以把进程数增加，以充分利用IO带宽（主要似乎是IO操作有block）。

所以，**服务器是“多个CPU＋gzip+网站总文件大小大于内存”的环境，worker_processes设置为CPU个数的两倍比较好**。

出现502错误，网页打不开的原因:

worker_processes默认情况下为1，一般情况下不用修改，但考虑到实际情况，可以修改这个数值，以提高性能;
官方的建议是修改成CPU的内核数，这里引用一段翻译过的文章：
worker_processes指明了nginx要开启的进程数，
据官方说法，一般开一个就够了，多开几个，可以减少机器io带来的影响。

```
nginx.conf

worker_processes  4;
```
